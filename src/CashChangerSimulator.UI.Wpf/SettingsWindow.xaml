<Window
    x:Class="CashChangerSimulator.UI.Wpf.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:CashChangerSimulator.UI.Wpf.ViewModels"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance Type=vm:SettingsViewModel, IsDesignTimeCreatable=False}"
    Title="Settings" Height="620" Width="640"
    Background="{StaticResource BackgroundBrush}"
    Foreground="{StaticResource OnBackgroundBrush}"
    WindowStartupLocation="CenterOwner"
    ResizeMode="NoResize">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock 
            Text="âš™ SETTINGS"
            FontSize="20"
            FontWeight="Bold"
            Foreground="{StaticResource PrimaryBrush}"
            Margin="0,0,0,20"/>

        <!-- Currency Section -->
        <Border
            Grid.Row="1"
            Style="{StaticResource CardStyle}"
            Margin="0,0,0,16">
            <StackPanel>
                <TextBlock
                    Text="CURRENCY SETTINGS"
                    FontSize="12"
                    FontWeight="Bold"
                    Foreground="{StaticResource TextSecondaryBrush}"
                    Margin="0,0,0,16"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="Currency"
                        VerticalAlignment="Center"
                        Foreground="{StaticResource OnSurfaceBrush}"/>
                    <ComboBox 
                        Grid.Column="1"
                        ItemsSource="{Binding AvailableCurrencyCodes}"
                        SelectedItem="{Binding CurrencyCode}"
                        Style="{StaticResource ModernComboBoxStyle}"
                        Height="36"
                        VerticalContentAlignment="Center"/>
                </Grid>
                <TextBlock 
                    Text="* App restart required to apply currency change."
                    FontSize="10"
                    Foreground="{StaticResource TextSecondaryBrush}"
                    Margin="0,8,0,0"/>
            </StackPanel>
        </Border>

        <!-- Thresholds Section -->
        <Border
            Grid.Row="2"
            Style="{StaticResource CardStyle}"
            Margin="0,0,0,16">
            <StackPanel>
                <TextBlock
                    Text="THRESHOLD SETTINGS"
                    FontSize="12"
                    FontWeight="Bold"
                    Foreground="{StaticResource TextSecondaryBrush}"
                    Margin="0,0,0,16"/>

                <!-- NearEmpty -->
                <Grid Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="NearEmpty"
                        VerticalAlignment="Center"
                        Foreground="{StaticResource OnSurfaceBrush}"/>
                    <TextBox 
                        Grid.Column="1"
                        Text="{Binding NearEmpty, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}"
                        Style="{StaticResource ModernTextBoxStyle}"
                        Height="36"
                        VerticalContentAlignment="Center"
                        FontSize="14"/>
                </Grid>

                <!-- NearFull -->
                <Grid Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="NearFull"
                        VerticalAlignment="Center"
                        Foreground="{StaticResource OnSurfaceBrush}"/>
                    <TextBox 
                        Grid.Column="1" 
                        Text="{Binding NearFull, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}" 
                        Style="{StaticResource ModernTextBoxStyle}" 
                        Height="36" 
                        VerticalContentAlignment="Center" 
                        FontSize="14"/>
                </Grid>

                <!-- Full -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock 
                        Text="Full"
                        VerticalAlignment="Center"
                        Foreground="{StaticResource OnSurfaceBrush}"/>
                    <TextBox
                        Grid.Column="1"
                        Text="{Binding Full, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}"
                        Style="{StaticResource ModernTextBoxStyle}" 
                        Height="36"
                        VerticalContentAlignment="Center"
                        FontSize="14"/>
                </Grid>
            </StackPanel>
        </Border>

        <!-- Detail Settings Section -->
        <Border 
            Grid.Row="3"
            Style="{StaticResource CardStyle}">
            <DockPanel>
                <TextBlock
                    DockPanel.Dock="Top"
                    Text="DENOMINATION DETAILS"
                    FontSize="12"
                    FontWeight="Bold"
                    Foreground="{StaticResource TextSecondaryBrush}"
                    Margin="0,0,0,12"/>
                
                <DataGrid
                    ItemsSource="{Binding DenominationSettings}"
                    AutoGenerateColumns="False"
                    CanUserAddRows="False"
                    CanUserDeleteRows="False"
                    Background="Transparent"
                    BorderThickness="0"
                    RowBackground="Transparent"
                    AlternatingRowBackground="#08FFFFFF"
                    Foreground="{StaticResource OnSurfaceBrush}"
                    HeadersVisibility="Column"
                    GridLinesVisibility="Horizontal"
                    HorizontalGridLinesBrush="#1AFFFFFF"
                    RowHeaderWidth="0">
                    <DataGrid.Resources>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                            <Setter Property="Padding" Value="8,4"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="FontSize" Value="11"/>
                            <Setter Property="BorderThickness" Value="0,0,0,1"/>
                            <Setter Property="BorderBrush" Value="#20FFFFFF"/>
                        </Style>
                        <Style TargetType="DataGridCell">
                            <Setter Property="Padding" Value="8,4"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#306200EE"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.Resources>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="NAME" Binding="{Binding DisplayName, UpdateSourceTrigger=PropertyChanged}" Width="*"/>
                        <DataGridTextColumn Header="COUNT" Binding="{Binding Count, UpdateSourceTrigger=PropertyChanged}" Width="70"/>
                        <DataGridTextColumn Header="N.EMPTY" Binding="{Binding NearEmpty, UpdateSourceTrigger=PropertyChanged}" Width="70"/>
                        <DataGridTextColumn Header="N.FULL" Binding="{Binding NearFull, UpdateSourceTrigger=PropertyChanged}" Width="70"/>
                        <DataGridTextColumn Header="FULL" Binding="{Binding Full, UpdateSourceTrigger=PropertyChanged}" Width="70"/>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Border>

        <!-- Action Buttons -->
        <Grid
            Grid.Row="4"
            Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button
                Content="Default"
                Command="{Binding ResetToDefaultCommand}"
                Style="{StaticResource IconButtonStyle}"
                Width="80" Height="40"
                FontSize="13"
                Foreground="#A0A0A0"/>

            <Button
                Grid.Column="2"
                Content="Cancel"
                IsCancel="True"
                Style="{StaticResource IconButtonStyle}"
                Width="80" Height="40"
                Margin="0,0,8,0"
                FontSize="13"/>

            <Button
                Grid.Column="3"
                Content="Save"
                Command="{Binding SaveCommand}"
                Style="{StaticResource PrimaryButtonStyle}"
                Width="80" Height="40"
                FontSize="13"
                Click="SaveButton_Click"/>
        </Grid>
    </Grid>
</Window>
