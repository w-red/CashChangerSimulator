<UserControl x:Class="CashChangerSimulator.UI.Wpf.Controls.PosTransactionControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:vm="clr-namespace:CashChangerSimulator.UI.Wpf.ViewModels"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance Type=vm:PosTransactionViewModel}"
             AutomationProperties.AutomationId="PosTransactionComponent">
    
    <Border Style="{StaticResource CardStyle}" Background="{StaticResource SurfaceBrush}">
        <Grid>
            <!-- IDLE STATE: Entry of Target Amount -->
            <StackPanel Visibility="{Binding TransactionStatus.Value, Converter={StaticResource VisibilityConv}, ConverterParameter=Idle}">
                <TextBlock Text="POS TRANSACTION" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}" FontWeight="Black" Margin="0,0,0,16"/>
                <TextBlock Text="Enter Payment Amount" HorizontalAlignment="Center" Margin="0,0,0,8" Opacity="0.7"/>
                <Grid Width="250" HorizontalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBox materialDesign:HintAssist.Hint="Amount to Pay" 
                             Text="{Binding TargetAmountInput.Value, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ModernTextBoxStyle}"
                             FontSize="24" FontWeight="Bold"
                             Margin="0,0,8,0">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding StartCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>
                    <Button Grid.Column="1" 
                            Style="{StaticResource PrimaryButtonStyle}"
                            Command="{Binding StartCommand}"
                            Content="START" Padding="16,0" Height="48"/>
                </Grid>
                <TextBlock Text="Please input the total price for the transaction" 
                           FontSize="10" Opacity="0.5" HorizontalAlignment="Center" Margin="0,8,0,0"/>
            </StackPanel>

            <!-- WAITING FOR CASH -->
            <StackPanel Visibility="{Binding TransactionStatus.Value, Converter={StaticResource VisibilityConv}, ConverterParameter=WaitingForCash}">
                <TextBlock Text="PAYMENT IN PROGRESS" FontSize="11" Foreground="SkyBlue" FontWeight="Black" Margin="0,0,0,16"/>
                
                <Grid Margin="0,0,0,24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                        <TextBlock Text="TOTAL DUE" FontSize="10" Opacity="0.5"/>
                        <TextBlock Text="{Binding TargetAmountInput.Value, StringFormat={}{0:N0}}" FontSize="32" FontWeight="Bold"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" HorizontalAlignment="Center" Margin="16,0,0,0">
                        <TextBlock Text="INSERTED" FontSize="10" Opacity="0.5"/>
                        <TextBlock Text="{Binding InsertedAmount.Value, StringFormat={}{0:N0}}" FontSize="32" FontWeight="Thin" Foreground="{StaticResource PrimaryBrush}"/>
                    </StackPanel>
                </Grid>

                <ProgressBar Value="{Binding InsertedAmount.Value}" 
                             Maximum="{Binding TargetAmountInput.Value}"
                             Height="10" Margin="16,0,16,8"
                             Foreground="{StaticResource PrimaryBrush}"
                             Background="#1AFFFFFF"/>
                
                <TextBlock Text="{Binding RemainingAmount.Value, StringFormat={}Remaining: {0:N0} JPY}" 
                           HorizontalAlignment="Center" FontSize="14" FontWeight="Bold" Margin="0,0,0,16"/>

                <Button Content="CANCEL TRANSACTION" 
                        Style="{StaticResource ModernFlatButtonStyle}"
                        Command="{Binding CancelCommand}"
                        Foreground="IndianRed"
                        HorizontalAlignment="Center"/>
            </StackPanel>

            <!-- DISPENSING CHANGE -->
            <StackPanel Visibility="{Binding TransactionStatus.Value, Converter={StaticResource VisibilityConv}, ConverterParameter=DispensingChange}" 
                        VerticalAlignment="Center">
                <materialDesign:PackIcon Kind="CashMultiple" Width="48" Height="48" HorizontalAlignment="Center" Foreground="LightGreen" Margin="0,0,0,16"/>
                <TextBlock Text="DISPENSING CHANGE" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center"/>
                <TextBlock Text="{Binding ChangeAmount.Value, StringFormat={}{0:N0}}" FontSize="32" HorizontalAlignment="Center" Margin="0,8,0,0"/>
                <TextBlock Text="Please wait while your change is being processed..." FontSize="11" Opacity="0.5" HorizontalAlignment="Center" Margin="0,16,0,0"/>
            </StackPanel>

            <!-- COMPLETED -->
            <StackPanel Visibility="{Binding TransactionStatus.Value, Converter={StaticResource VisibilityConv}, ConverterParameter=Completed}" 
                        VerticalAlignment="Center">
                <materialDesign:PackIcon Kind="CheckCircle" Width="64" Height="64" HorizontalAlignment="Center" Foreground="MediumSpringGreen" Margin="0,0,0,16"/>
                <TextBlock Text="PAYMENT COMPLETED" FontSize="20" FontWeight="Black" HorizontalAlignment="Center"/>
                <TextBlock Text="Thank you for your purchase!" FontSize="12" Opacity="0.7" HorizontalAlignment="Center" Margin="0,8,0,0"/>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
